---
phase: 05-add-documentation-deployment-guide-and-project-showcase-page
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/deploy.md
  - docs/config.md
  - docs/architecture.md
  - docs/FUTURE.md
autonomous: true
requirements: []

must_haves:
  truths:
    - "docs/deploy.md has a step-by-step Kubernetes deployment walkthrough with copy-pasteable commands"
    - "docs/config.md documents all 18 MAILROOM_ env vars with types, defaults, and descriptions"
    - "docs/architecture.md contains a Mermaid diagram of the triage pipeline and component descriptions"
    - "docs/FUTURE.md captures the open-core vision (public engine, closed SaaS layer)"
  artifacts:
    - path: "docs/deploy.md"
      provides: "Kubernetes deployment guide"
      contains: "kubectl apply"
    - path: "docs/config.md"
      provides: "Environment variable reference"
      contains: "MAILROOM_JMAP_TOKEN"
    - path: "docs/architecture.md"
      provides: "Architecture overview with Mermaid diagram"
      contains: "mermaid"
    - path: "docs/FUTURE.md"
      provides: "Open-core vision notes"
      contains: "open-core"
  key_links:
    - from: "docs/architecture.md"
      to: "src/mailroom/workflows/screener.py"
      via: "describes ScreenerWorkflow pipeline"
      pattern: "ScreenerWorkflow"
    - from: "docs/config.md"
      to: "src/mailroom/core/config.py"
      via: "documents all MailroomSettings fields"
      pattern: "MAILROOM_"
---

<objective>
Create the docs/ folder with four markdown documents: deploy.md (Kubernetes walkthrough), config.md (env var reference), architecture.md (Mermaid diagram + component text), and FUTURE.md (open-core vision).

Purpose: Provide focused, deep documentation that the README links to. Each doc serves a distinct audience: deploy.md for operators, config.md for customizers, architecture.md for contributors, FUTURE.md for the author's strategic notes.
Output: docs/deploy.md, docs/config.md, docs/architecture.md, docs/FUTURE.md
</objective>

<execution_context>
@/Users/flo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/flo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-add-documentation-deployment-guide-and-project-showcase-page/05-CONTEXT.md
@.planning/phases/05-add-documentation-deployment-guide-and-project-showcase-page/05-RESEARCH.md
@src/mailroom/core/config.py
@k8s/configmap.yaml
@k8s/deployment.yaml
@k8s/namespace.yaml
@k8s/secret.yaml.example
@Dockerfile
@src/mailroom/__main__.py
@src/mailroom/workflows/screener.py
@src/mailroom/clients/jmap.py
@src/mailroom/clients/carddav.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/deploy.md and docs/config.md</name>
  <files>docs/deploy.md, docs/config.md</files>
  <action>
Create the `docs/` directory if it doesn't exist.

**docs/deploy.md** — Step-by-step Kubernetes deployment guide. Structure:

1. **Title**: "Deploying Mailroom to Kubernetes"
2. **Prerequisites**: Docker, kubectl, access to a k8s cluster, Fastmail account with API token and app password
3. **Steps** (copy-pasteable commands, assumes k8s familiarity):
   - Build the Docker image: `docker build -t ghcr.io/hellothisisflo/mailroom:latest .`
   - Push to registry: `docker push ghcr.io/hellothisisflo/mailroom:latest`
   - Create namespace: `kubectl apply -f k8s/namespace.yaml`
   - Create secrets: Copy `k8s/secret.yaml.example` to `k8s/secret.yaml`, fill in real credentials (base64 encode), `kubectl apply -f k8s/secret.yaml`
   - Apply ConfigMap: `kubectl apply -f k8s/configmap.yaml`
   - Deploy: `kubectl apply -f k8s/deployment.yaml`
   - Verify: `kubectl -n mailroom get pods`, `kubectl -n mailroom logs -f deploy/mailroom`
4. **Health check**: Mention the /healthz endpoint on port 8080
5. **Updating**: Build new image, push, `kubectl -n mailroom rollout restart deploy/mailroom`
6. **Troubleshooting**: Common issues (missing env vars, wrong credentials, connection failures)

Note: The secret.yaml.example uses `stringData` (per project decisions), so users fill in plaintext values — no base64 encoding needed. Check the actual k8s/secret.yaml.example to confirm this before writing the docs.

**docs/config.md** — Hand-written configuration reference. Structure:

1. **Title**: "Configuration Reference"
2. **Overview**: All config via MAILROOM_-prefixed env vars, loaded by pydantic-settings
3. **Table or sections** for each variable group:
   - **Credentials** (required): JMAP_TOKEN, CARDDAV_USERNAME, CARDDAV_PASSWORD — types, no defaults, where to get them
   - **Polling**: POLL_INTERVAL — int, default 300 (5 min)
   - **Logging**: LOG_LEVEL — string, default "info", valid values
   - **Triage Labels**: All 5 label vars with defaults
   - **System Labels**: Error and warning labels, WARNINGS_ENABLED (bool, default true)
   - **Screener**: SCREENER_MAILBOX with default
   - **Contact Groups**: All 4 group vars with defaults
4. **.env.example** reference: mention it exists at project root for quick setup

Derive all info from `src/mailroom/core/config.py`. Cross-reference every field. There are 18 configurable fields total.
  </action>
  <verify>
    <automated>test -f docs/deploy.md && test -f docs/config.md && grep -q "kubectl" docs/deploy.md && grep -q "MAILROOM_JMAP_TOKEN" docs/config.md && echo "PASS" || echo "FAIL"</automated>
    <manual>Verify deploy.md commands are copy-pasteable and config.md covers all 18 env vars</manual>
  </verify>
  <done>docs/deploy.md has step-by-step k8s walkthrough with copy-pasteable commands. docs/config.md documents all 18 MAILROOM_ env vars with types, defaults, and descriptions.</done>
</task>

<task type="auto">
  <name>Task 2: Create docs/architecture.md and docs/FUTURE.md</name>
  <files>docs/architecture.md, docs/FUTURE.md</files>
  <action>
**docs/architecture.md** — Architecture overview with Mermaid diagram. Structure:

1. **Title**: "Architecture"
2. **Overview**: One paragraph explaining Mailroom's architecture — a polling service with two protocol clients (JMAP for email, CardDAV for contacts) orchestrated by a workflow layer.
3. **Mermaid diagram** — Use a flowchart showing the triage pipeline. Based on research recommendation:
   ```mermaid
   flowchart LR
       A[Fastmail\nScreener] -->|JMAP poll| B[Mailroom\nService]
       B -->|Extract sender| C{Triage\nLabel?}
       C -->|@ToImbox| D[CardDAV:\nAdd to Imbox group]
       C -->|@ToFeed| E[CardDAV:\nAdd to Feed group]
       C -->|@ToPaperTrail| F[CardDAV:\nAdd to Paper Trail group]
       C -->|@ToJail| G[CardDAV:\nAdd to Jail group]
       D & E & F & G -->|JMAP sweep| H[Move emails\nto destination]
   ```
   Keep it focused and simple — GitHub renders natively.

4. **Components** — Short description of each:
   - **ScreenerWorkflow** (`src/mailroom/workflows/screener.py`): The orchestrator. poll() is the main entry point. Handles conflict detection, per-sender processing, error/warning labeling, retry safety.
   - **JMAPClient** (`src/mailroom/clients/jmap.py`): Email operations via JMAP protocol. Session discovery, mailbox resolution, email query/move/label operations.
   - **CardDAVClient** (`src/mailroom/clients/carddav.py`): Contact operations via CardDAV protocol. PROPFIND discovery, group validation, contact search/create/upsert, group membership.
   - **MailroomSettings** (`src/mailroom/core/config.py`): Configuration via pydantic-settings with MAILROOM_ prefix.

5. **Key Design Decisions** — brief bullets:
   - Triage label removed last (retry safety)
   - Error labels are additive (don't remove triage label)
   - Company contacts by default, person contacts via @ToPerson
   - Merge-cautious: never overwrite existing contact data

6. **Planning**: "This project's planning and roadmap are managed with GSD. See `.planning/` for details."

**docs/FUTURE.md** — Open-core vision notes. Structure:

1. **Title**: "Future Vision"
2. **Open-Core Strategy**: Public engine stays AGPL open source. Future closed SaaS layer (OAuth Fastmail login, hosted infrastructure, rule builder UI, billing) in a separate private repo. Reference the Plausible, Cal.com, Supabase model.
3. **Hosted Service**: OAuth-based Fastmail login, managed infrastructure, no Docker/k8s needed for end users.
4. **Rule Builder UI**: Visual interface for defining triage rules beyond the 4 default destinations.
5. **Multi-Provider**: Potential expansion beyond Fastmail (abstracting the JMAP/CardDAV layer).
6. **Note**: This is strategic thinking for the author, not a public roadmap commitment.
  </action>
  <verify>
    <automated>test -f docs/architecture.md && test -f docs/FUTURE.md && grep -q "mermaid" docs/architecture.md && grep -q "open-core" docs/FUTURE.md && echo "PASS" || echo "FAIL"</automated>
    <manual>Preview architecture.md on GitHub to verify Mermaid renders. Check FUTURE.md captures the strategic vision.</manual>
  </verify>
  <done>docs/architecture.md has Mermaid diagram and component descriptions. docs/FUTURE.md captures open-core vision with hosted SaaS and rule builder directions.</done>
</task>

</tasks>

<verification>
- `docs/` directory exists with 4 markdown files
- deploy.md has k8s walkthrough with `kubectl apply` commands
- config.md covers all 18 env vars from config.py
- architecture.md has a Mermaid flowchart that GitHub renders
- FUTURE.md captures open-core strategy referencing Plausible/Cal.com/Supabase model
</verification>

<success_criteria>
All four docs/ files exist. deploy.md is copy-pasteable by someone with k8s experience. config.md matches every field in config.py. architecture.md Mermaid diagram renders correctly on GitHub. FUTURE.md captures the author's strategic vision.
</success_criteria>

<output>
After completion, create `.planning/phases/05-add-documentation-deployment-guide-and-project-showcase-page/05-02-SUMMARY.md`
</output>
