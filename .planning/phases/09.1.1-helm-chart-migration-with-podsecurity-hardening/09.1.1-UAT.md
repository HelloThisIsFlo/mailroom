---
status: complete
phase: 09.1.1-helm-chart-migration-with-podsecurity-hardening
source: [09.1.1-01-SUMMARY.md, 09.1.1-02-SUMMARY.md]
started: 2026-03-01T22:45:00Z
updated: 2026-03-02T00:00:00Z
---

## Current Test

[testing complete]

## Tests

### 1. Helm chart lints cleanly
expected: Running `helm lint helm/mailroom/` produces no errors or warnings. Exit code 0.
result: pass

### 2. All Kubernetes resources render
expected: Running `helm template mailroom helm/mailroom/` outputs 5 resources: Namespace, ConfigMap, Secret, Deployment, and Job (setup). No template rendering errors.
result: pass

### 3. PSS restricted securityContext applied
expected: In `helm template` output, both the Deployment pod and the Setup Job pod include: `runAsNonRoot: true`, `drop: ["ALL"]` capabilities, `readOnlyRootFilesystem: true`, and `seccompProfile: type: RuntimeDefault`.
result: pass

### 4. Setup Job is a Helm hook with dry-run default
expected: The rendered Job has annotations `helm.sh/hook: pre-install,pre-upgrade` and `helm.sh/hook-delete-policy`. The Job command runs `mailroom setup` (dry-run, no --apply) by default. Setting `setup.apply: true` in values changes command to include `--apply`.
result: pass

### 5. ConfigMap renders config.yaml from values
expected: The rendered ConfigMap contains a `config.yaml` key whose content matches the `config:` block in `values.yaml` (triage categories, polling settings, etc. rendered via toYaml).
result: pass

### 6. Nil-safe secret rendering without values
expected: Running `helm template mailroom helm/mailroom/` with NO secrets provided (default empty `secrets: {}`) renders the Secret resource without errors. All secret values default to empty strings.
result: pass

### 7. k8s/ directory fully removed
expected: No `k8s/` directory exists in the repository. The old plain Kubernetes manifests (namespace.yaml, deployment.yaml, configmap.yaml, secret.yaml.example) are gone.
result: pass

### 8. Secrets onboarding and .gitignore
expected: `helm/mailroom/secrets-values.yaml.example` exists with placeholder credentials and usage instructions. `.gitignore` contains `helm/mailroom/secrets-values.yaml` (not the old `k8s/secret.yaml`).
result: pass

## Summary

total: 8
passed: 8
issues: 0
pending: 0
skipped: 0

## Gaps

[none yet]
