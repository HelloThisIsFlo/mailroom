# Phase 3.1: Person Contact Type with @ToPerson Label - Context

**Gathered:** 2026-02-25
**Status:** Ready for planning

<domain>
## Phase Boundary

Default new contacts to company type (ORG field, empty N) instead of person type. Add a `@ToPerson` triage label that creates person-type contacts (FN + N with first/last name) routed to the Imbox group. Introduce a general-purpose `@MailroomWarning` label for non-blocking alerts (first use case: name mismatch on existing contacts).

</domain>

<decisions>
## Implementation Decisions

### Contact field mapping
- **Company contacts (default for @ToImbox, @ToFeed, @ToPaperTrail, @ToJail):**
  - `FN` = display name (required by CardDAV)
  - `ORG` = display name (same value as FN)
  - `N` = empty (this is what makes Fastmail render it as a company)
  - `EMAIL` = sender email
- **Person contacts (@ToPerson only):**
  - `FN` = display name
  - `N` = first/last parsed from display name via a name parsing library
  - No `ORG` field
  - `EMAIL` = sender email
- Verified via CardDAV: Fastmail requires FN but accepts empty N + ORG to display as company

### NOTE field behavior
- **New contacts:** "Added by Mailroom on {date}"
- **Existing contacts (upsert):** "Updated by Mailroom on {date}"
- If existing note is present: append Mailroom note below with empty line separator (never overwrite)
- Spacing between existing note and Mailroom note: Claude's discretion

### @ToPerson label
- Label name: `@ToPerson`
- Imbox-only — no person variants for other destinations
- Routes to the same Imbox contact group and Inbox mailbox as @ToImbox
- Only difference from @ToImbox: creates person-type contact fields instead of company-type
- **Conflicts with @ToImbox** — if both labels appear on the same sender, flag as `@MailroomError` (ambiguous person vs company intent)
- Also conflicts with @ToFeed, @ToPaperTrail, @ToJail (same as existing conflict detection)

### Name parsing
- Use a name parsing library (researcher evaluates options — not locked to a specific library)
- Single-word display names → given name only, family empty
- No display name (empty or just email) → use email prefix as given name, family empty

### Existing contact upsert behavior
- **Existing contacts are never modified** regardless of label — only added to the target group
- The company/person field logic only applies when **creating** new contacts
- When @ToPerson encounters an existing contact with different name fields: process normally but apply `@MailroomWarning`

### @MailroomWarning label
- General-purpose warning label (not limited to name mismatches)
- Processing continues normally — warning is a non-blocking nudge to check logs
- Log entry explains what was detected (e.g., "Name mismatch: email says 'John Smith', contact has 'J. Smith'. Original name kept.")
- Configurable via `MAILROOM_WARNINGS_ENABLED` env var (default: true)
- **Startup validation:** when enabled, verify `@MailroomWarning` label exists in Fastmail at startup (fail fast if missing, same as other labels)

### Claude's Discretion
- Spacing between existing note and Mailroom note (1 vs 2 blank lines)
- Specific name parsing library choice (after researcher evaluates)
- Log message formatting for warnings
- Whether @MailroomWarning needs additional Fastmail config (sublabel structure, etc.)

</decisions>

<specifics>
## Specific Ideas

- The user tested via Fastmail UI and CardDAV that company contacts work with FN + ORG + empty N
- @MailroomWarning is designed for the user's solo use initially, but should be toggleable for when others use the system
- Follow existing patterns: startup label validation, env var config convention (MAILROOM_ prefix), conflict detection via @MailroomError

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 03.1-person-contact-type-with-toperson-label*
*Context gathered: 2026-02-25*
