---
milestone: v1.1
audited: 2026-02-28T12:00:00Z
status: tech_debt
scores:
  requirements: 18/18
  phases: 3/3
  integration: 18/18
  flows: 3/3
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 06-configurable-categories
    items:
      - "Human tests 7-12 reference stale label_to_group_mapping dict API (renamed to label_to_category_mapping with ResolvedCategory attribute access) — will raise AttributeError at runtime"
      - "Human test test_3_label.py references deleted settings.label_to_imbox field"
  - phase: 07-setup-script
    items:
      - "JMAPClient.session_capabilities property populated but never read in production code (built for future sieve capability introspection, intentionally descoped in Phase 7)"
      - "Duplicate ANSI color helpers in reporting.py and sieve_guidance.py (documented design decision — 6 lines each, different output patterns)"
  - phase: 08-eventsource-push
    items:
      - "PUSH-06 sub-10-second latency verified via code path analysis; live human verification with test_16 still pending"
---

# Milestone v1.1 "Push & Config" — Audit Report

**Audited:** 2026-02-28
**Status:** TECH DEBT (no blockers, accumulated deferred items)
**Scores:** 18/18 requirements | 3/3 phases | 18/18 integration wiring | 3/3 E2E flows

## Requirements Coverage (3-Source Cross-Reference)

| REQ-ID | Description | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-------------|-----------------|---------------------|-----------------|--------------|
| CONFIG-01 | Triage categories as structured list | SATISFIED | 06-01 | [x] | **satisfied** |
| CONFIG-02 | Configurable via JSON env var | SATISFIED | 06-01 | [x] | **satisfied** |
| CONFIG-03 | Default categories match v1.0 | SATISFIED | 06-01 | [x] | **satisfied** |
| CONFIG-04 | Derived properties from category mapping | SATISFIED | 06-02 | [x] | **satisfied** |
| CONFIG-05 | Custom triage categories | SATISFIED | 06-02 | [x] | **satisfied** |
| CONFIG-06 | Startup validation rejects invalid config | SATISFIED | 06-01 | [x] | **satisfied** |
| SETUP-01 | Creates missing mailboxes via JMAP | SATISFIED | 07-01, 07-02, 07-04 | [x] | **satisfied** |
| SETUP-02 | Creates missing contact groups via CardDAV | SATISFIED | 07-01, 07-02, 07-04 | [x] | **satisfied** |
| SETUP-03 | Idempotent (reports "already exists") | SATISFIED | 07-02, 07-03, 07-04 | [x] | **satisfied** |
| SETUP-04 | Human-readable sieve rule instructions | SATISFIED | 07-03, 07-04 | [x] | **satisfied** |
| SETUP-05 | Requires --apply flag (dry-run default) | SATISFIED | 07-02, 07-03, 07-04 | [x] | **satisfied** |
| SETUP-06 | Reads same config as main service | SATISFIED | 07-01, 07-02, 07-04 | [x] | **satisfied** |
| PUSH-01 | SSE listener with Bearer auth | SATISFIED | 08-01 | [x] | **satisfied** |
| PUSH-02 | Configurable debounce window (3s default) | SATISFIED | 08-01, 08-03 | [x] | **satisfied** |
| PUSH-03 | Liveness via ping-based timeout | SATISFIED | 08-01 | [x] | **satisfied** |
| PUSH-04 | Auto-reconnect with exponential backoff | SATISFIED | 08-01, 08-03 | [x] | **satisfied** |
| PUSH-05 | Health endpoint with EventSource status | SATISFIED | 08-02 | [x] | **satisfied** |
| PUSH-06 | Sub-10-second push triage latency | SATISFIED | 08-02, 08-03 | [x] | **satisfied** |

**Orphaned requirements:** None (all 18 REQ-IDs present in at least one phase VERIFICATION.md)

## Phase Verification Summary

| Phase | Status | Score | Re-verified | Tests |
|-------|--------|-------|-------------|-------|
| 06 — Configurable Categories | PASSED | 15/15 | No | 211 |
| 07 — Setup Script | PASSED | 23/23 | Yes (after Plan 04 gap closure) | 253 |
| 08 — EventSource Push | PASSED | 20/20 | Yes (after Plan 03 gap closure) | 276 |

All 3 phases verified with zero critical gaps. Final test suite: **276 tests passing in 0.70s**.

## Cross-Phase Integration

Integration checker verified **18 cross-phase export connections** — all properly wired.

### E2E Flows Verified

| Flow | Status | Path |
|------|--------|------|
| Service Run (`python -m mailroom`) | COMPLETE | `__main__.py` → `cli.py` → `main()` → `MailroomSettings` → SSE thread + queue-based loop → `workflow.poll()` → `/healthz` |
| Setup Dry-Run (`mailroom setup`) | COMPLETE | `cli.py` → `run_setup(apply=False)` → `plan_resources` → `generate_sieve_guidance` → `print_plan` |
| Setup Apply (`mailroom setup --apply`) | COMPLETE | `cli.py` → `run_setup(apply=True)` → `plan_resources` → `apply_resources` → `generate_sieve_guidance` → `print_plan` |

### Cross-Phase Wiring

| From | To | Connection | Status |
|------|----|-----------|--------|
| Phase 6 `triage_categories` | Phase 7 `provisioner` | `settings.required_mailboxes`, `triage_labels`, `contact_groups` | WIRED |
| Phase 6 `triage_categories` | Phase 8 main loop | `settings.debounce_seconds`, `poll_interval` | WIRED |
| Phase 6 `label_to_category_mapping` | Phase 8 screener | `screener.py:303,362` attribute access | WIRED |
| Phase 6 `_resolved_categories` | Phase 7 sieve guidance | `sieve_guidance.py:61` root category filtering | WIRED |
| Phase 7 `create_mailbox` | Phase 7 provisioner | `provisioner.py:143` via `jmap.create_mailbox()` | WIRED |
| Phase 7 `create_group` | Phase 7 provisioner | `provisioner.py:170` via `carddav.create_group()` | WIRED |
| Phase 8 `sse_listener` | Phase 8 main loop | `__main__.py:146` thread target | WIRED |
| Phase 8 `drain_queue` | Phase 8 main loop | `__main__.py:182` debounce consumption | WIRED |
| Phase 8 `event_source_url` | Phase 8 main loop | `__main__.py:145` SSE URL check | WIRED |
| Phase 8 health fields | Phase 8 `/healthz` | `HealthHandler` class attributes read in `do_GET` | WIRED |

### Orphaned Exports

| Export | Phase | Reason | Impact |
|--------|-------|--------|--------|
| `JMAPClient.session_capabilities` | 07 | Built for future sieve capability introspection; explicitly descoped in Plan 07-03 | None — property populated but never read; no runtime cost |

## Tech Debt Summary

### Phase 6: Configurable Categories
- **7 human-test files** reference stale `label_to_group_mapping` dict API (renamed to `label_to_category_mapping` with `ResolvedCategory` attribute access). Running tests 7-12 will raise `AttributeError`. Fix is mechanical: rename property + switch from `["key"]` to `.attribute` access. Tracked in `deferred-items.md`.
- **test_3_label.py** references deleted `settings.label_to_imbox` field.

### Phase 7: Setup Script
- **`session_capabilities`** property populated but never consumed (intentional descope for v1.1).
- **Duplicate ANSI color helpers** in `reporting.py` and `sieve_guidance.py` (6 lines each, documented design decision).

### Phase 8: EventSource Push
- **PUSH-06 live latency** verified via code path analysis; human test 16 (`test_16_eventsource_push.py`) ready but requires live Fastmail account + running service.

**Total:** 5 items across 3 phases. None are blockers.

## Human Tests Status

| Test | Phase | Status | Notes |
|------|-------|--------|-------|
| test_3_label.py | 06 | STALE | References deleted `label_to_imbox` field |
| test_7_screener_poll.py | 06 | STALE | References old `label_to_group_mapping` API |
| test_8_conflict_detection.py | 06 | STALE | References old `label_to_group_mapping` API |
| test_9_already_grouped.py | 06 | STALE | References old `label_to_group_mapping` API (2 sites) |
| test_10_retry_safety.py | 06 | STALE | References old `label_to_group_mapping` API |
| test_11_person_contact.py | 06 | STALE | References old `label_to_group_mapping` API |
| test_12_company_contact.py | 06 | STALE | References old `label_to_group_mapping` API + `label_to_imbox` |
| test_14_setup_dry_run.py | 07 | PASSED (UAT 2026-02-27) | 6 steps, 9/9 passed |
| test_15_setup_apply.py | 07 | PASSED (UAT 2026-02-27) | 6 steps, 9/9 passed |
| test_16_eventsource_push.py | 08 | READY | Pending live latency verification |

## Milestone Definition of Done

From ROADMAP.md: *"Replace polling with push notifications, make triage categories user-configurable, and add automated Fastmail setup."*

| Goal | Status | Evidence |
|------|--------|----------|
| Replace polling with push notifications | ACHIEVED | SSE listener + queue-based debounced loop; fallback polling preserved |
| Make triage categories user-configurable | ACHIEVED | `MAILROOM_TRIAGE_CATEGORIES` JSON env var; custom categories work end-to-end |
| Add automated Fastmail setup | ACHIEVED | `mailroom setup --apply` provisions mailboxes and contact groups; sieve guidance included |

---

*Audited: 2026-02-28*
*Auditor: Claude (milestone audit)*
